<!doctype html>
<html>

<head>
    <meta charset="utf-8" />

    <title>WebGL&nbsp;Test</title>
</head>

<script src="./script/d3.v5.min.js"></script>
<script src="./script/pixi.v5.min.js"></script>

<body>

    <div id="plotRegi"></div>

    <script>
        d3.tsv("../demo_data/pbmc.tsv").then(function (data) {
            var width = 600
            var height = 600

            var scale_x = d3
                .scaleLinear()
                .domain([-50, 50])
                .range([0, width])

            var scale_y = d3
                .scaleLinear()
                .domain([-50, 50])
                .range([height, 0])

            function get_random_color(n) {
                R = new Set()
                G = new Set()
                B = new Set()

                while (R.size < n) { R.add(Math.ceil(Math.random() * 255).toString(16)) }
                while (G.size < n) { G.add(Math.ceil(Math.random() * 255).toString(16)) }
                while (B.size < n) { B.add(Math.ceil(Math.random() * 255).toString(16)) }

                return [Array.from(R), Array.from(G), Array.from(B)]
            }

            var color_list = get_random_color(100)

            var app = new PIXI.Application({ width, height, transparent: 1, resolution: 1 });
            document.body.appendChild(app.view);

            // circle = new PIXI.Graphics()

            d3
                .select(app.view)
                .selectAll("NONE")
                .data(data, d => d)
                .enter()
                .each(d => {
                    circle = new PIXI.Graphics()
                    circle.beginFill(
                        "0x" +
                        color_list[0][d.seurat_clusters] +
                        color_list[1][d.seurat_clusters] +
                        color_list[2][d.seurat_clusters]
                    )

                    circle.drawCircle(scale_x(d.TSNE_1), scale_y(d.TSNE_2), 1)
                    circle.endFill()

                    app.stage.addChild(circle)
                })
        })
    </script>

</body>

</html>